<div class="content-header">
    <div class="container-fluid">
        <h1>Data User Aplikasi Notepent</h1>
    </div>
</div>

<div class="container-fluid px-4">
    <div class="card">
        <h5 class="card-header bg-danger">Data Pentest</h5>
        <div class="card-body">
            <!-- Tombol Katakunci -->
            <form action="" method="get">
                <div class="input-group py-3">
                    <input type="text" class="form-control" placeholder="Masukan Katakunci"
                        value="<?php echo $katakunci?>" name="katakunci" aria-label="Recipient's username"
                        aria-describedby="button-addon2">
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="submit" id="cari">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>

            <!-- Tabel Data -->
            <table class="table table-striped table-bordered table-responsive">
                <thead class="text-center bg-secondary">
                    <tr class="">
                        <th rowspan="2">Id User</th>
                        <th rowspan="2">Pemohon</th>
                        <th rowspan="2">Tanggal</th>
                        <th rowspan="2">URL Target</th>
                        <th rowspan="2">Nama Instansi</th>
                        <th colspan="3">Penanggung Jawab</th>
                        <th rowspan="2">IP Address</th>
                        <th rowspan="2">Status Hosting</th>
                        <th colspan="3">Hasil Pentest</th>
                        <th rowspan="2">Keterangan</th>

                    </tr>
                    <tr>
                        <th>Nama</th>
                        <th>Email</th>
                        <th>Kontak</th>
                        <th>High</th>
                        <th>Medium</th>
                        <th>Low</th>
                    </tr>
                </thead>
                <tbody>
                    <?php
                    foreach($dataPentest as $k => $v) { 
                        $nomor = $nomor + 1;
                    ?>
                    <tr>
                        <td><?php echo $v ['id_pentest'] ?></td>
                        <td><?php echo $v ['pemohon'] ?></td>
                        <td><?php echo $v ['tanggal'] ?></td>
                        <td><?php echo $v ['url_target'] ?></td>
                        <td><?php echo $v ['nama_in'] ?></td>
                        <td><?php echo $v ['p_jawab'] ?></td>
                        <td><?php echo $v ['p_email'] ?></td>
                        <td><?php echo $v ['p_no'] ?></td>
                        <td><?php echo $v ['ip_addres'] ?></td>
                        <td><?php echo $v ['status_hg'] ?></td>
                        <td><?php echo $v ['h_high'] ?></td>
                        <td><?php echo $v ['h_med'] ?></td>
                        <td><?php echo $v ['h_low'] ?></td>
                        <td><?php echo $v ['ket'] ?></td>
                    </tr>
                    <?php } ?>
                </tbody>
            </table>
            <br>
            <?php
                $linkPagination = $pager->links();
                $linkPagination = str_replace('<li class="active">','<li class="page-item active">',$linkPagination);
                $linkPagination = str_replace('<li>','<li class="page-item">', $linkPagination);
                $linkPagination = str_replace("<a","<a class='page-link'",$linkPagination);
                echo $linkPagination;
            ?>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous">
</script>

<script>
function hapus($id) {
    var result = confirm('Yakin ingin menghapus data');
    if (result) {
        window.location = "<?php echo site_url("tabelpentestuser/hapus")?>/" + $id;

    }
}

function edit($id) {
    $.ajax({
        url: "<?php echo site_url("tabelpentestuser/edit")?>/" + $id,
        type: "get",
        success: function(hasil) {
            var $obj = $.parseJSON(hasil);
            if ($obj.id != '') {
                $('#inputId').val($obj.id);
                $('#inputIdPentest').val($obj.id_pentest);
                $('#inputPemohon').val($obj.pemohon);
                $('#inputTanggal').val($obj.tanggal);
                $('#inputUrl').val($obj.url_target);
                $('#inputDinas').val($obj.nama_in);
                $('#inputPjawab').val($obj.p_jawab);
                $('#inputPemail').val($obj.p_email);
                $('#inputPkontak').val($obj.p_no);
                $('#inputIpAddress').val($obj.ip_addres);
                $('#inputStatusHosting').val($obj.status_hg);
                $('#inputHigh').val($obj.h_high);
                $('#inputMedium').val($obj.h_med);
                $('#inputLow').val($obj.h_low);
                $('#inputKeterangan').val($obj.ket);
            }
        }
    });

}

function bersihkan() {
    $('#inputId').val('');
    $('#inputIdPentest').val('');
    $('#inputPemohon').val('');
    $('#inputTanggal').val('');
    $('#inputUrl').val('');
    $('#inputDinas').val('');
    $('#inputPjawab').val('');
    $('#inputPemail').val('');
    $('#inputPkontak').val('');
    $('#inputIpAddress').val('');
    $('#inputStatusHosting').val('');
    $('#inputHigh').val('');
    $('#inputMedium').val('');
    $('#inputLow').val('');
    $('#inputKeterangan').val('');
}
$('.tombol-tutup').on('click', function() {
    if ($('.sukses').is(":visible")) {
        window.location.href = "<?php echo current_url()."?".$_SERVER['QUERY_STRING']?>";
    }
    bersihkan();
});

$('#tombolSimpan').on('click', function() {
    var $id = $('#inputId').val();
    var $id_pentest = $('#inputIdPentest').val();
    var $pemohon = $('#inputPemohon').val();
    var $tanggal = $('#inputTanggal').val();
    var $url_target = $('#inputUrl').val();
    var $nama_in = $('#inputDinas').val();
    var $p_jawab = $('#inputPjawab').val();
    var $p_email = $('#inputPemail').val();
    var $p_no = $('#inputPkontak').val();
    var $ip_addres = $('#inputIpAddress').val();
    var $status_hg = $('#inputStatusHosting').val();
    var $h_high = $('#inputHigh').val();
    var $h_med = $('#inputMedium').val();
    var $h_low = $('#inputLow').val();
    var $ket = $('#inputKeterangan').val();


    $.ajax({
        url: "<?php echo site_url('tabelpentestuser/simpan')?>",
        type: "POST",
        data: {
            id: $id,
            id_pentest: $id_pentest,
            pemohon: $pemohon,
            tanggal: $tanggal,
            url_target: $url_target,
            nama_in: $nama_in,
            p_jawab: $p_jawab,
            p_email: $p_email,
            p_no: $p_no,
            ip_addres: $ip_addres,
            status_hg: $status_hg,
            h_high: $h_high,
            h_med: $h_med,
            h_low: $h_low,
            ket: $ket

        },
        success: function(hasil) {
            var $obj = $.parseJSON(hasil);
            if ($obj.sukses == false) {
                $('.sukses').hide();
                $('.error').show();
                $('.error').html($obj.error);

            } else {
                $('.error').hide();
                $('.sukses').show();
                $('.sukses').html($obj.sukses);
            }
        }
    });
    bersihkan();
});
</script>