<?php

namespace App\Controllers;

use App\Controllers\BaseController;
use App\Models\ModelPentest;

class AjukanPentest extends BaseController
{

    public function __construct()
    {
        $this->model = new \App\Models\ModelPentest();
    }
    
    public function simpan() 
    {
        $validasi = \config\Services::validation();
        $aturan = [
            'pemohon' => [
                'label' => 'Pemohon',
                'rules' => 'required|min_length[5]',
                'errors' => [
                    'required'=>'{field} harus diisi',
                    'min_length' => 'Minimum karakter untuk {field} adalah 5 karakter',
                ],
            ],
            
            'url_target' => [
                'label' => 'URL Target',
                'rules' => 'required|min_length[5]|',
                'errors' => [
                    'required'=>'{field} harus diisi',
                    'min_length' => 'Minimum karakter untuk {field} adalah 5 karakter',

                ],
            ],


            'ip_addres' => [
                'label' => 'IP Address',
                'rules' => 'required|min_length[5]',
                'errors' => [
                    'required'=>'{field} harus diisi',
                    'min_length' => 'Minimum karakter untuk {field} adalah 5 karakter'
                ],
            ],
        ];
        
        $validasi->setRules($aturan);
        if($validasi->withRequest($this->request)->run()) 
        {
            $id = $this->request->getPost('id');
            $pemohon = $this->request->getPost('pemohon');
            $tanggal = $this->request->getPost('tanggal');
            $url_target = $this->request->getPost('url_target');
            $nama_in = $this->request->getPost('nama_in');
            $p_jawab = $this->request->getPost('p_jawab');
            $p_email = $this->request->getPost('p_email');
            $p_no = $this->request->getPost('p_no');
            $ip_addres = $this->request->getPost('ip_addres');

            $data = [
                'id'=>$id,
                'pemohon'=>$pemohon,
                'tanggal'=>$tanggal,
                'url_target'=>$url_target,
                'nama_in'=>$nama_in,
                'p_jawab'=>$p_jawab,
                'p_email'=>$p_email,
                'p_no'=>$p_no,
                'ip_addres'=>$ip_addres,
                
            ];

            $this->model->save($data);

            $hasil['sukses'] ='Berhasil Memasukan Data, Silahkan Tutup Kembali';
            $hasil['error'] = true;
        }
        else
        {
            $hasil['sukses'] =false;
            $hasil['error'] = $validasi->listErrors();

        }

  
      return json_encode($hasil);
    }
    
    public function index()
    {
        $data=[
            'judul'=>'Form Ajukan Pentest',
            'subjudul'=>'Ajukan Pentest',
            'menu'=>'form ajukan pentest',
            'submenu'=>'ajukan pentest',
            'page'=>'user/v_form_ajukan_pentest'
        ];
        return view('template/v_admin',$data); 
        
    }

}
